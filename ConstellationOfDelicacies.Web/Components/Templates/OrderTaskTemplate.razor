@using ConstellationOfDelicacies.Bll.Models.InputModels

<Modal @ref="modal" />

<Card Style="width:330px; margin-bottom: 10px; margin-right: 10px">
    <CardBody>
        <CardTitle>
            <div class="task-header">
                <div class="task-header-title"><span>@OrderTask.Title</span></div>
                <div class="task-status">
                    <TaskStatusTemplate Status="OrderTask.Status" />
                </div>                
            </div>            
        </CardTitle>
        <CardText>
            <div class="task-workers">
                <div>
                    <p class="order-tasks-title task-workers-title">Сотрудники:</p>
                </div>
                @if (OrderTask.Users.Count() == 0)
                {
                    <div>
                        <p>не назначены</p>
                    </div>                    
                } else
                {
                    <div>
                        @foreach (var u in OrderTask.Users)
                        {
                            <p>@u.FirstName @u.LastName</p>
                        }
                    </div>                    
                }
            </div>
        </CardText>
        <div>
            <Button class="task-button" Color="ButtonColor.Primary" Type="ButtonType.Button" @onclick="EditTask">
                Изменить задачу
            </Button>
            <Button class="task-button" Color="ButtonColor.Primary" Type="ButtonType.Button" @onclick="EditWorkers">
                Изменить сотрудников
            </Button>
        </div>
        
    </CardBody>
</Card>

@code {
    [Parameter, EditorRequired]
    public TasksOutputModel OrderTask { get; set; }

    [Parameter]
    public Action UpdatePage { get; set; }

    private Modal modal = default!;

    private async Task EditTask()
    {
        modal.IsVerticallyCentered = true;
        modal.IsScrollable = true;

        var parameters = new Dictionary<string, object>();
        parameters.Add("OrderTask", OrderTask);
        parameters.Add("UpdatePage", UpdatePage);

        await modal.ShowAsync<EditTaskTemplate>(title: $"Изменить задачу: {OrderTask.Title}", parameters: parameters);
    }

    private async Task EditWorkers()
    {
        modal.IsVerticallyCentered = true;
        modal.IsScrollable = true;

        var parameters = new Dictionary<string, object>();
        parameters.Add("OrderTask", OrderTask);
        parameters.Add("UpdatePage", UpdatePage);

        await modal.ShowAsync<EditTaskWorkersTemplate>(title: $"Изменить сотрудников: {OrderTask.Title}", 
                                                    parameters: parameters);
    }

}
